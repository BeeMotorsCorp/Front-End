<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catálogo - Sport Gun Imports</title>
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .catalogo-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
            min-height: 100vh;
            margin-top: 80px;
        }

        .catalogo-header {
            margin-bottom: 3rem;
            text-align: center;
        }

        .catalogo-header h1 {
            font-size: 3rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        .catalogo-header p {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        .catalogo-content {
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 2rem;
        }

        /* SIDEBAR FILTROS */
        .filtros-sidebar {
            background: var(--background-card);
            padding: 2rem;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            height: fit-content;
            position: sticky;
            top: 100px;
        }

        .filtro-titulo {
            font-size: 1.1rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 1rem;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .filtro-grupo {
            margin-bottom: 2rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid var(--border-color);
        }

        .filtro-grupo:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .filtro-label {
            display: block;
            margin-bottom: 0.75rem;
            font-size: 0.9rem;
            cursor: pointer;
            transition: var(--transition);
            color: var(--text-secondary);
        }

        .filtro-label:hover {
            color: var(--primary-color);
        }

        .filtro-label input {
            margin-right: 0.5rem;
            cursor: pointer;
            accent-color: var(--primary-color);
        }

        .filtro-range {
            margin-top: 1rem;
        }

        .filtro-range input[type="range"] {
            width: 100%;
            cursor: pointer;
        }

        .filtro-valor {
            display: flex;
            justify-content: space-between;
            margin-top: 0.5rem;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .btn-limpar-filtros {
            width: 100%;
            padding: 12px;
            background: transparent;
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            margin-top: 1rem;
        }

        .btn-limpar-filtros:hover {
            background: var(--primary-color);
            color: white;
        }

        /* AREA DE PRODUTOS */
        .produtos-area {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        .busca-barra {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .busca-input {
            flex: 1;
            padding: 14px 16px;
            background: var(--background-card);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 1rem;
            transition: var(--transition);
        }

        .busca-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1);
        }

        .busca-input::placeholder {
            color: var(--text-light);
        }

        .busca-btn {
            padding: 14px 28px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .busca-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .ordenacao {
            display: flex;
            gap: 1rem;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .ordenacao label {
            color: var(--text-secondary);
            font-weight: 600;
            font-size: 0.9rem;
            text-transform: uppercase;
        }

        .ordenacao select {
            padding: 10px 12px;
            background: var(--background-card);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            cursor: pointer;
            transition: var(--transition);
        }

        .ordenacao select:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .resultados-info {
            color: var(--text-secondary);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 1rem;
        }

        .produtos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
            gap: 1.5rem;
        }

        .produto-card {
            background: var(--background-card);
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
            cursor: pointer;
            display: flex;
            flex-direction: column;
        }

        .produto-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-hover);
            border-color: var(--primary-color);
        }

        .produto-imagem {
            position: relative;
            height: 220px;
            overflow: hidden;
            background: var(--background);
        }

        .produto-imagem img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: var(--transition);
        }

        .produto-card:hover .produto-imagem img {
            transform: scale(1.05);
        }

        .produto-badge {
            position: absolute;
            top: 12px;
            left: 12px;
            background: var(--primary-color);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .produto-info {
            padding: 1.25rem;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .produto-nome {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
            line-height: 1.4;
            min-height: 2.8em;
        }

        .produto-rating {
            display: flex;
            align-items: center;
            gap: 4px;
            margin-bottom: 0.75rem;
            color: var(--primary-color);
            font-size: 0.85rem;
        }

        .produto-detalhes {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            margin-bottom: 1rem;
            font-size: 0.8rem;
        }

        .detalhe-item {
            background: var(--background);
            padding: 4px 8px;
            border-radius: 4px;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .produto-preco {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .produto-estoque {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 1rem;
        }

        .produto-estoque.baixo {
            color: #F59E0B;
        }

        .produto-estoque.indisponivel {
            color: #EF4444;
        }

        .btn-produto {
            padding: 10px 14px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.9rem;
            text-transform: uppercase;
        }

        .btn-produto:hover {
            background: var(--primary-dark);
        }

        .btn-produto:disabled {
            background: var(--text-light);
            cursor: not-allowed;
        }

        .vazio {
            grid-column: 1 / -1;
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text-secondary);
        }

        .vazio i {
            font-size: 3rem;
            margin-bottom: 1rem;
            display: block;
        }

        .vazio h3 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        /* RESPONSIVO */
        @media (max-width: 1024px) {
            .catalogo-content {
                grid-template-columns: 1fr;
            }

            .filtros-sidebar {
                position: relative;
                top: 0;
            }

            .produtos-grid {
                grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            }
        }

        @media (max-width: 768px) {
            .catalogo-container {
                padding: 1rem;
                margin-top: 70px;
            }

            .catalogo-header h1 {
                font-size: 2rem;
            }

            .busca-barra {
                flex-direction: column;
            }

            .produtos-grid {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
                gap: 1rem;
            }

            .filtros-sidebar {
                display: none;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <nav class="nav">
            <div class="nav__logo">
                <img src="Imagens/Logo.png" alt="Sport Gun Imports" class="logo">
                <span class="logo-text">Sport Gun</span>
            </div>
            
            <ul class="nav__menu">
                <li><a href="index.html">Menu</a></li>
                <li><a href="catalogo.html">Catálogo</a></li>
                <li><a href="index.html#noticias">Notícias</a></li>
            </ul>

            <div class="nav__actions">
                <button id="btnPerfil" class="btn btn--profile" style="display: none;">
                    <i class="fas fa-user-circle"></i> Perfil
                </button>
                <a href="login.html" id="btnLogin" class="btn btn--login">Entrar</a>
                <a href="cadastro.html" class="btn btn--register">Registrar</a>
            </div>
        </nav>
    </header>

    <!-- Cabeçalho do Catálogo -->
    <div class="catalogo-container">
        <div class="catalogo-header">
            <h1>Catálogo de Produtos</h1>
            <p>Encontre as melhores armas e acessórios do mercado</p>
        </div>

        <div class="catalogo-content">
            <!-- SIDEBAR FILTROS -->
            <aside class="filtros-sidebar">
                <h3 class="filtro-titulo">
                    <i class="fas fa-filter"></i> Filtros
                </h3>

                <!-- Busca por Nome -->
                <div class="filtro-grupo">
                    <label class="filtro-titulo" style="color: var(--text-primary); margin-bottom: 0.75rem;">
                        <i class="fas fa-search"></i> Buscar
                    </label>
                    <input type="text" id="filtroNome" class="busca-input" placeholder="Nome do produto...">
                </div>

                <!-- Categoria -->
                <div class="filtro-grupo">
                    <h4 class="filtro-titulo">Categoria</h4>
                    <label class="filtro-label">
                        <input type="checkbox" class="filtro-categoria" value="pistola">
                        Pistola
                    </label>
                    <label class="filtro-label">
                        <input type="checkbox" class="filtro-categoria" value="revolver">
                        Revólver
                    </label>
                    <label class="filtro-label">
                        <input type="checkbox" class="filtro-categoria" value="rifle">
                        Rifle
                    </label>
                    <label class="filtro-label">
                        <input type="checkbox" class="filtro-categoria" value="carabina">
                        Carabina
                    </label>
                </div>

                <!-- Calibre -->
                <div class="filtro-grupo">
                    <h4 class="filtro-titulo">Calibre</h4>
                    <label class="filtro-label">
                        <input type="checkbox" class="filtro-calibre" value="9mm">
                        9mm
                    </label>
                    <label class="filtro-label">
                        <input type="checkbox" class="filtro-calibre" value=".40 S&W">
                        .40 S&W
                    </label>
                    <label class="filtro-label">
                        <input type="checkbox" class="filtro-calibre" value=".45 ACP">
                        .45 ACP
                    </label>
                    <label class="filtro-label">
                        <input type="checkbox" class="filtro-calibre" value="5.56x45mm">
                        5.56x45mm
                    </label>
                    <label class="filtro-label">
                        <input type="checkbox" class="filtro-calibre" value="7.62x51mm">
                        7.62x51mm
                    </label>
                </div>

                <!-- Preço -->
                <div class="filtro-grupo">
                    <h4 class="filtro-titulo">Preço</h4>
                    <div class="filtro-range">
                        <input type="range" id="filtroPrecoMin" class="filtro-preco-range" min="0" max="50000" value="0">
                        <input type="range" id="filtroPrecoMax" class="filtro-preco-range" min="0" max="50000" value="50000">
                        <div class="filtro-valor">
                            <span>R$ <span id="precoMinDisplay">0</span></span>
                            <span>R$ <span id="precoMaxDisplay">50000</span></span>
                        </div>
                    </div>
                </div>

                <!-- Disponibilidade -->
                <div class="filtro-grupo">
                    <h4 class="filtro-titulo">Disponibilidade</h4>
                    <label class="filtro-label">
                        <input type="checkbox" id="filtroDisponivel" checked>
                        Apenas disponíveis
                    </label>
                </div>

                <!-- Botão Limpar -->
                <button class="btn-limpar-filtros" onclick="limparFiltros()">
                    <i class="fas fa-redo"></i> Limpar Filtros
                </button>
            </aside>

            <!-- AREA DE PRODUTOS -->
            <main class="produtos-area">
                <!-- Busca -->
                <div class="busca-barra">
                    <input type="text" id="buscaPrincipal" class="busca-input" placeholder="Buscar por nome, marca, calibre...">
                    <button class="busca-btn" onclick="aplicarFiltros()">
                        <i class="fas fa-search"></i> Buscar
                    </button>
                </div>

                <!-- Ordenação -->
                <div class="ordenacao">
                    <label>Ordenar por:</label>
                    <select id="ordenacao" onchange="aplicarFiltros()">
                        <option value="relevancia">Relevância</option>
                        <option value="precoAsc">Preço (Menor)</option>
                        <option value="precoDesc">Preço (Maior)</option>
                        <option value="nomeAsc">Nome (A-Z)</option>
                        <option value="nomeDesc">Nome (Z-A)</option>
                    </select>
                </div>

                <!-- Info Resultados -->
                <div class="resultados-info" id="resultadosInfo"></div>

                <!-- Grid de Produtos -->
                <div class="produtos-grid" id="produtosGrid">
                    <div style="grid-column: 1/-1; text-align: center; padding: 3rem;">
                        <i class="fas fa-spinner fa-spin" style="font-size: 2rem; color: var(--primary-color); margin-bottom: 1rem; display: block;"></i>
                        <p style="color: var(--text-secondary);">Carregando produtos...</p>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script>
        let todosProdutos = [];

        // Carregar produtos ao abrir página
        document.addEventListener('DOMContentLoaded', async () => {
            await carregarProdutos();
            verificarLogin();
        });

        // CARREGAR PRODUTOS DO BANCO
        async function carregarProdutos() {
            try {
                const response = await fetch('Front-End/gun/painel.php');
                if (response.ok) {
                    todosProdutos = await response.json();
                    aplicarFiltros();
                }
            } catch (error) {
                console.error('Erro ao carregar produtos:', error);
                document.getElementById('produtosGrid').innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 3rem; color: #EF4444;">
                        <i class="fas fa-exclamation-triangle" style="font-size: 2rem; margin-bottom: 1rem; display: block;"></i>
                        <p>Erro ao carregar produtos</p>
                    </div>
                `;
            }
        }

        // APLICAR FILTROS
        function aplicarFiltros() {
            let filtrados = [...todosProdutos];

            // Filtro por nome/busca
            const busca = (document.getElementById('buscaPrincipal').value + document.getElementById('filtroNome').value).toLowerCase();
            if (busca) {
                filtrados = filtrados.filter(p => 
                    p.nome.toLowerCase().includes(busca) ||
                    p.marca?.toLowerCase().includes(busca) ||
                    p.calibre?.toLowerCase().includes(busca)
                );
            }

            // Filtro por categoria
            const categorias = Array.from(document.querySelectorAll('.filtro-categoria:checked')).map(c => c.value);
            if (categorias.length > 0) {
                filtrados = filtrados.filter(p => categorias.includes(p.categoria));
            }

            // Filtro por calibre
            const calibres = Array.from(document.querySelectorAll('.filtro-calibre:checked')).map(c => c.value);
            if (calibres.length > 0) {
                filtrados = filtrados.filter(p => calibres.includes(p.calibre));
            }

            // Filtro por preço
            const precoMin = parseInt(document.getElementById('filtroPrecoMin').value);
            const precoMax = parseInt(document.getElementById('filtroPrecoMax').value);
            filtrados = filtrados.filter(p => p.preco >= precoMin && p.preco <= precoMax);

            // Filtro por disponibilidade
            if (document.getElementById('filtroDisponivel').checked) {
                filtrados = filtrados.filter(p => p.disponivel === 1 || p.disponivel === '1' || p.disponivel === true);
            }

            // Ordenação
            const ordem = document.getElementById('ordenacao').value;
            switch(ordem) {
                case 'precoAsc':
                    filtrados.sort((a, b) => a.preco - b.preco);
                    break;
                case 'precoDesc':
                    filtrados.sort((a, b) => b.preco - a.preco);
                    break;
                case 'nomeAsc':
                    filtrados.sort((a, b) => a.nome.localeCompare(b.nome));
                    break;
                case 'nomeDesc':
                    filtrados.sort((a, b) => b.nome.localeCompare(a.nome));
                    break;
            }

            // Mostrar resultados
            exibirProdutos(filtrados);
        }

        // EXIBIR PRODUTOS
        function exibirProdutos(produtos) {
            const grid = document.getElementById('produtosGrid');
            const info = document.getElementById('resultadosInfo');

            info.textContent = `${produtos.length} produto(s) encontrado(s)`;

            if (produtos.length === 0) {
                grid.innerHTML = `
                    <div class="vazio">
                        <i class="fas fa-inbox"></i>
                        <h3>Nenhum produto encontrado</h3>
                        <p>Tente ajustar seus filtros</p>
                    </div>
                `;
                return;
            }

            grid.innerHTML = produtos.map(p => `
                <div class="produto-card" onclick="verProduto(${p.id})">
                    <div class="produto-imagem">
                        <img src="${p.imagem || 'https://via.placeholder.com/260x220/1F1F1F/DC2626?text=Sem+Imagem'}" 
                             alt="${p.nome}"
                             onerror="this.src='https://via.placeholder.com/260x220/1F1F1F/DC2626?text=Erro'">
                        ${p.badge ? `<span class="produto-badge">${p.badge}</span>` : ''}
                    </div>
                    <div class="produto-info">
                        <h3 class="produto-nome">${p.nome}</h3>
                        <div class="produto-rating">
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star-half-alt"></i>
                            <span>4.8</span>
                        </div>
                        <div class="produto-detalhes">
                            ${p.calibre ? `<span class="detalhe-item"><i class="fas fa-bullseye"></i> ${p.calibre}</span>` : ''}
                            ${p.capacidade ? `<span class="detalhe-item"><i class="fas fa-layer-group"></i> ${p.capacidade}</span>` : ''}
                        </div>
                        <div class="produto-preco">R$ ${parseFloat(p.preco).toLocaleString('pt-BR', {minimumFractionDigits: 2})}</div>
                        <div class="produto-estoque ${p.estoque < 5 ? 'baixo' : ''} ${!p.disponivel ? 'indisponivel' : ''}">
                            ${!p.disponivel ? 'Indisponível' : p.estoque < 5 ? `⚠️ Apenas ${p.estoque} em estoque` : `Estoque: ${p.estoque}`}
                        </div>
                        <button class="btn-produto" ${!p.disponivel ? 'disabled' : ''} onclick="event.stopPropagation(); alert('Adicionado ao carrinho!')">
                            ${!p.disponivel ? 'Indisponível' : 'Ver Detalhes'}
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // VER PRODUTO (Abrir página de detalhes)
        function verProduto(id) {
            window.location.href = `produto.html?id=${id}`;
        }

        // LIMPAR FILTROS
        function limparFiltros() {
            document.querySelectorAll('input[type="checkbox"]').forEach(c => {
                c.checked = c.id === 'filtroDisponivel';
            });
            document.getElementById('filtroNome').value = '';
            document.getElementById('buscaPrincipal').value = '';
            document.getElementById('filtroPrecoMin').value = '0';
            document.getElementById('filtroPrecoMax').value = '50000';
            document.getElementById('precoMinDisplay').textContent = '0';
            document.getElementById('precoMaxDisplay').textContent = '50000';
            document.getElementById('ordenacao').value = 'relevancia';
            aplicarFiltros();
        }

        // ATUALIZAR DISPLAY DE PREÇO
        document.getElementById('filtroPrecoMin').addEventListener('input', (e) => {
            document.getElementById('precoMinDisplay').textContent = e.target.value;
            aplicarFiltros();
        });

        document.getElementById('filtroPrecoMax').addEventListener('input', (e) => {
            document.getElementById('precoMaxDisplay').textContent = e.target.value;
            aplicarFiltros();
        });

        document.querySelectorAll('.filtro-categoria, .filtro-calibre').forEach(c => {
            c.addEventListener('change', aplicarFiltros);
        });

        document.getElementById('filtroDisponivel').addEventListener('change', aplicarFiltros);

        // VERIFICAR LOGIN
        function verificarLogin() {
            const usuarioId = localStorage.getItem('usuario_id');
            const btnPerfil = document.getElementById('btnPerfil');
            const btnLogin = document.getElementById('btnLogin');

            if (usuarioId) {
                btnPerfil.style.display = 'inline-flex';
                btnLogin.style.display = 'none';
                btnPerfil.addEventListener('click', () => {
                    window.location.href = 'usuario.html';
                });
            }
        }
    </script>
</body>
</html>